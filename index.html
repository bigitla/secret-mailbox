<!DOCTYPE html>
<html>
<head>
  <title>Crypto Shequirrel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Open Sans', sans-serif;
    background: url('/bg.png') no-repeat center center fixed;
    background-size: cover;
    color: #87CEFA;
    position: relative;
    z-index: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: -1;
  }

  .layout, .layout * {
    box-sizing: border-box;
  }

  .layout {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: center;
    max-width: 500px;
    width: 100%;
    margin: 1em auto;
  }

  h2 {
    text-align: left;
    margin-bottom: 1em;
  }

  label {
    margin-top: 1em;
    text-align: left;
    width: 100%;
  }

  input, textarea {
    margin-top: 0.5em;
    padding: 0.75em;
    font-size: 1em;
    background-color: #111;
    color: #87CEFA;
    border: 1px solid #444;
    border-radius: 5px;
    width: 100%;
  }

  textarea {
    resize: none;
  }

  .split-button {
    display: flex;
    margin-top: 1em;
    margin-bottom: 0em;
    border-radius: 5px;
    overflow: hidden;
    box-shadow: 0 0 5px rgba(135, 206, 250, 0.3);
    width: 100%;
    border: 1px solid #444;
  }

  .split-button button {
    flex: 1;
    padding: 0.75em 0;
    font-size: 1em;
    background-color: #222;
    color: #87CEFA;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s ease;
    text-align: center;
  }

  .split-button button:first-child {
    border-right: 1px solid #444;
  }

  .split-button button:hover {
    background-color: #333;
    box-shadow: 0 0 10px rgba(135, 206, 250, 0.6);
    transition: all 0.3s ease;
  }

  .message {
    background: #111;
    color: #87CEFA;
    padding: 1em;
    margin-top: 1em;
    border: 1px solid #444;
    border-radius: 5px;
    cursor: pointer;
    animation: slideIn 0.4s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .timestamp {
    margin-bottom: 0.5em;
    font-weight: bold;
    display: block;
  }

  .preview {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .full {
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: anywhere;
    margin-top: 0.5em;
    display: none;
  }

  .copy-id {
    font-size: 0.8em;
    color: #87CEFA;
    cursor: pointer;
    text-decoration: underline;
  }

  .copy-id:hover {
    color: #ffffff;
  }

  /* VEIL ‚Äî keep it one single line, centered, without changing layout widths */
  #veil {
    font-style: italic;
    color: #aaa;
    margin-top: 0;
    text-align: center;
    margin-top: 0em;
    margin-bottom: 0em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: clip;
    width: 100vw;
    max-width: 100vw;
    padding: 0 1em;    
    display: block;
    box-sizing: border-box;
    pointer-events: none;
    font-size: 1em;
    align-self: stretch;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  img.squirrel {
    width: 100%;
    max-width: 300px;
    margin-top: 0.1em;
    margin-bottom: 0.1em;
    display: block;
    margin-left: auto;
    margin-right: auto;
    background-color: transparent;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 1s ease forwards 0.5s;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #outputWrapper {
    max-width: 500px;   /* match .layout */
    width: 100%;
    margin: 8em auto 0 auto; /* center it like .layout */
    position: relative;
  }

  #outputWrapper.scrollable {
    max-height: 600px;
    overflow-y: auto;
    padding-right: 0.5em;
  }

  #outputWrapper.scrollable::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.6));
    pointer-events: none;
  }

  @media (max-width: 480px) {
    body {
      font-size: 1.1em;
    }

    /* No stacking ‚Äî keep buttons side-by-side */
    .split-button {
      flex-direction: row;
      align-items: stretch;
    }

    .split-button button {
      width: 100%;
      box-sizing: border-box;
      text-align: center;
    }

    .split-button button:first-child {
      border-right: 1px solid #444;
      border-bottom: none;
    }
  }
</style>


</head>
<body>
  <div class="layout">
    <h2>‚Çø Crypto Shequirrel</h2>

    <label for="keyword">Private Key:</label>
    <input type="password" id="keyword">

    <label for="messageInput">Message:</label>
    <textarea id="messageInput" rows="4"></textarea>

    <div class="split-button">
      <button onclick="saveToServer()">üì© Drop</button>
      <button onclick="loadMessages()">üì¨ Check</button>
    </div>
  </div>
<img src="/squirrel.png" alt="Shequirrel" class="squirrel">
<p id="veil">These words are sealed in silence, waiting for the one who knows the name.</p>
    
  <div id="outputWrapper">
      <div id="output"></div>
 </div>

  <script>
    async function saveToServer() {
      const keyword = document.getElementById('keyword').value;
      const message = document.getElementById('messageInput').value;
      if (!keyword || !message) {
        alert("Please enter both keyword and message.");
        return;
      }

      const ciphertext = CryptoJS.AES.encrypt(message, keyword).toString();
      const timestamp = new Date().toISOString();
      const id = crypto.randomUUID();

      const res = await fetch('/mailbox', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, message: ciphertext, timestamp })
      });

      if (res.ok) {
        document.getElementById('messageInput').value = '';
        loadMessages();
      }
    }

    async function loadMessages() {
      const keyword = document.getElementById('keyword').value;
      const res = await fetch('/mailbox');
      const data = await res.json();

      let output = '';
      let decryptedAny = false;

      data.slice().reverse().forEach((msgObj) => {
        const msg = msgObj.message;
        const time = msgObj.timestamp ? new Date(msgObj.timestamp).toLocaleString() : 'üï∞Ô∏è';
        const id = msgObj.id || '';

        try {
          const bytes = CryptoJS.AES.decrypt(msg, keyword);
          const originalText = bytes.toString(CryptoJS.enc.Utf8);
          if (originalText) {
            decryptedAny = true;
            const firstLine = originalText.split('\n')[0];
            output += `
              <div class="message" onclick="toggleMessage(this)">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span class="timestamp">${time}</span>
                  <span class="copy-id" onclick="event.stopPropagation(); copyId('${id}')">(ID)</span>
                </div>
                <div class="preview">${firstLine}</div>
                <div class="full">${originalText}</div>
              </div>
            `;
          }
        } catch {
          // silently skip undecryptable messages
        }
      });

      document.getElementById('output').innerHTML = output;
      document.getElementById('veil').style.display = decryptedAny ? 'none' : 'block';

      const outputContainer = document.getElementById('outputWrapper');
      outputContainer.classList.toggle('scrollable', data.length > 20);
    }

    function toggleMessage(el) {
      const preview = el.querySelector('.preview');
      const full = el.querySelector('.full');
      const isHidden = window.getComputedStyle(full).display === 'none';

      if (isHidden) {
        preview.style.display = 'none';
        full.style.display = 'block';
      } else {
        preview.style.display = 'block';
        full.style.display = 'none';
      }
    }

    function copyId(id) {
      if (!id) return;
      navigator.clipboard.writeText(id).then(() => {
        alert("Message ID copied to clipboard!");
      }).catch(err => {
        console.error("Failed to copy ID:", err);
      });
    }
  </script>
</body>
</html>



























